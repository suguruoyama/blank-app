import React, { useEffect, useMemo, useRef, useState } from "react";

// =============================================================
// AIã‚¢ãƒã‚¿ãƒ¼å±•ç¤ºä¼šã‚­ã‚ªã‚¹ã‚¯ï¼ˆ4ç¤¾ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ä»˜ãï¼‰
// å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚
// - 4ç¤¾ãƒœã‚¿ãƒ³ã§ä¼šç¤¾ã‚’åˆ‡æ›¿
// - è³ªå•â†’FAQãƒ™ãƒ¼ã‚¹ã®ç°¡æ˜“RAGã§å›ç­”ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ»ä½ã‚³ã‚¹ãƒˆï¼‰
// - Web Speech APIã§éŸ³å£°èª­ã¿ä¸Šã’ï¼ˆä»»æ„ï¼‰
// - ãƒ­ã‚°ã®CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
// - ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã®ã‚­ã‚ªã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰
// Tailwindå‰æã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆChatGPT Canvasã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯èƒ½ï¼‰
// =============================================================

// ---- ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ã¨ã§è‡ªç”±ã«ç·¨é›†å¯èƒ½ï¼‰ --------------------
const COMPANY_DATA: Record<string, {
  name: string;
  color: string; // ã‚¢ã‚¯ã‚»ãƒ³ãƒˆè‰²ï¼ˆTailwindï¼‰
  logoEmoji: string;
  faqs: { q: string; a: string; tags?: string[] }[];
  quick: string[]; // ã‚¯ã‚¤ãƒƒã‚¯è³ªå•
}> = {
  "A": {
    name: "A-Tech Tools",
    color: "from-cyan-500 to-blue-500",
    logoEmoji: "ğŸ› ï¸",
    faqs: [
      { q: "ä¸»åŠ›è£½å“ã¯ï¼Ÿ", a: "è¶…ç¡¬ã‚¨ãƒ³ãƒ‰ãƒŸãƒ«ï¼ˆé«˜è€æ‘©è€—ã‚°ãƒ¬ãƒ¼ãƒ‰VQï¼‰ãŒä¸»åŠ›ã§ã™ã€‚ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹ã‚„åˆé‡‘é‹¼ã®é«˜èƒ½ç‡åŠ å·¥ã«å¼·ã¿ãŒã‚ã‚Šã¾ã™ã€‚" },
      { q: "å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã¯ï¼Ÿ", a: "äºŒæ®µã‚®ãƒ£ãƒƒã‚·ãƒ¥ã¨ä¸ç­‰åˆ†å‰²è¨­è¨ˆã«ã‚ˆã‚Šã€ã³ã³ã‚ŠæŠ‘åˆ¶ã¨åˆ‡ã‚Šããšæ’å‡ºæ€§ã‚’ä¸¡ç«‹ã€‚å·¥å…·æœ¬æ•°å‰Šæ¸›ã«ã‚‚è²¢çŒ®ã—ã¾ã™ã€‚" },
      { q: "å¯¾å¿œæè³ªã¯ï¼Ÿ", a: "SCMã€SUS304ã€æå‡ºç¡¬åŒ–ç³»ã€ã‚¤ãƒ³ã‚³ãƒãƒ«ç­‰ã¾ã§å¹…åºƒãå¯¾å¿œã€‚æ¨å¥¨åˆ‡å‰Šæ¡ä»¶è¡¨ã‚‚ã”ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚" },
      { q: "ã‚µãƒ³ãƒ—ãƒ«æä¾›", a: "å±•ç¤ºä¼šé™å®šã§ãƒ‡ãƒ¢ã‚«ãƒƒã‚¿ãƒ¼ã‚’å°‘é‡ã”ç”¨æ„ã€‚ååˆºäº¤æ›ã§å¾Œæ—¥ç™ºé€ã„ãŸã—ã¾ã™ã€‚" },
    ],
    quick: ["ä¸»åŠ›è£½å“ã¯ï¼Ÿ", "å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã¯ï¼Ÿ", "å¯¾å¿œæè³ªã¯ï¼Ÿ"],
  },
  "B": {
    name: "B-Met Carbide",
    color: "from-emerald-500 to-teal-500",
    logoEmoji: "ğŸ§±",
    faqs: [
      { q: "ä¼šç¤¾æ¦‚è¦", a: "è¶…å¾®ç²’WC-Coåˆé‡‘ã®ç²‰æœ«ã‹ã‚‰ç„¼çµã¾ã§ä¸€è²«ç”Ÿç”£ã€‚ãƒ­ãƒƒãƒˆå®‰å®šæ€§ãŒå¼·ã¿ã§ã™ã€‚" },
      { q: "ç’°å¢ƒå¯¾å¿œ", a: "ISO 14001å–å¾—ã€CO2æ’å‡ºåŸå˜ä½ã‚’ç›´è¿‘3å¹´ã§18%å‰Šæ¸›ï¼ˆè‡ªç¤¾æ¯”ï¼‰ã€‚ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒªã‚µã‚¤ã‚¯ãƒ«æ¯”ç‡ã‚‚æ‹¡å¤§ä¸­ã€‚" },
      { q: "ã‚«ã‚¹ã‚¿ãƒ å¯¾å¿œ", a: "å°‘é‡å¤šå“ç¨®ã®ãƒ–ãƒ©ãƒ³ã‚¯ä¾›çµ¦ã«å¯¾å¿œã€‚å¤–å¾„Ï†3ã€œÏ†25ã€é•·ã•50ã€œ150mmãŒæ¨™æº–ãƒ¬ãƒ³ã‚¸ã§ã™ã€‚" },
    ],
    quick: ["ä¼šç¤¾æ¦‚è¦", "ç’°å¢ƒå¯¾å¿œ", "ã‚«ã‚¹ã‚¿ãƒ å¯¾å¿œ"],
  },
  "C": {
    name: "C-Drive Systems",
    color: "from-fuchsia-500 to-pink-500",
    logoEmoji: "âš™ï¸",
    faqs: [
      { q: "è£½å“ãƒ©ã‚¤ãƒ³ã‚¢ãƒƒãƒ—", a: "å·¥å…·ãƒ›ãƒ«ãƒ€ã€ã‚³ãƒ¬ãƒƒãƒˆã€ShrinkFitè£…ç½®ã¾ã§ã€‚é«˜æŠŠæŒåŠ›ã¨æŒ¯ã‚Œç²¾åº¦2Î¼mä»¥ä¸‹ã‚’å®Ÿç¾ã€‚" },
      { q: "å°å…¥åŠ¹æœ", a: "åˆƒå…ˆæŒ¯ã‚Œä½æ¸›ã§å¯¿å‘½+15ã€œ25%ï¼ˆå½“ç¤¾å®Ÿç¸¾ï¼‰ã€‚ä»•ä¸Šã’é¢ã®å®‰å®šåŒ–ã«å¯„ä¸ã—ã¾ã™ã€‚" },
      { q: "ã‚µãƒãƒ¼ãƒˆ", a: "ç¾å ´ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚µãƒãƒ¼ãƒˆã¨è©¦ä½œè©•ä¾¡ã®ç„¡å„Ÿãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã‚ã‚Šï¼ˆä¸€éƒ¨æ¡ä»¶ï¼‰ã€‚" },
    ],
    quick: ["è£½å“ãƒ©ã‚¤ãƒ³ã‚¢ãƒƒãƒ—", "å°å…¥åŠ¹æœ", "ã‚µãƒãƒ¼ãƒˆ"],
  },
  "D": {
    name: "D-Soft Vision",
    color: "from-amber-500 to-orange-500",
    logoEmoji: "ğŸ–¥ï¸",
    faqs: [
      { q: "ã‚½ãƒ•ãƒˆã®å¼·ã¿", a: "åˆ‡å‰Šæ¡ä»¶æœ€é©åŒ–AIï¼ˆã‚ªãƒ³ãƒ—ãƒ¬å¯ï¼‰ã€‚å®Ÿæ¸¬ãƒ­ã‚°ã‹ã‚‰å­¦ç¿’ã—ã€å·¥å…·å¯¿å‘½ã¨ã‚µã‚¤ã‚¯ãƒ«ã‚¿ã‚¤ãƒ ã‚’ä¸¡ç«‹ã€‚" },
      { q: "é€£æºå…ˆ", a: "ä¸»è¦CNCï¼ˆFanuc/Siemens/Heidenhainï¼‰ã‚„MESã¨APIé€£æºå¯èƒ½ã€‚" },
      { q: "ä¾¡æ ¼æ„Ÿ", a: "ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ã‚¿ãƒ¼ãƒˆã®ã‚µãƒ–ã‚¹ã‚¯æœˆé¡8ä¸‡å††ã€œï¼ˆã‚¿ã‚°æ•°ãƒ»æ©Ÿèƒ½ã§å¤‰å‹•ï¼‰ã€‚PoCãƒ—ãƒ©ãƒ³ã‚ã‚Šã€‚" },
    ],
    quick: ["ã‚½ãƒ•ãƒˆã®å¼·ã¿", "é€£æºå…ˆ", "ä¾¡æ ¼æ„Ÿ"],
  },
};

// ---- ç°¡æ˜“æ¤œç´¢ï¼ˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼‰ -------------------------------
function scoreQA(query: string, item: { q: string; a: string; tags?: string[] }) {
  const q = (query || "").toLowerCase();
  const text = [item.q, item.a, ...(item.tags || [])].join(" ").toLowerCase();
  if (!q.trim()) return 0;
  // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒˆãƒ¼ã‚¯ãƒ³ä¸€è‡´ï¼‹éƒ¨åˆ†ä¸€è‡´
  const tokens = q.split(/[\sã€ã€‚,.!ï¼Ÿ?]+/).filter(Boolean);
  let score = 0;
  for (const t of tokens) {
    if (text.includes(t)) score += 2; // éƒ¨åˆ†ä¸€è‡´
    // å®Œå…¨ä¸€è‡´ã£ã½ã„æ™‚ã«åŠ ç‚¹ï¼ˆã–ã£ãã‚Šï¼‰
    const re = new RegExp(`\\b${t.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")}\\b`);
    if (re.test(text)) score += 3;
  }
  // è³ªå•æ–‡ã¸ã®ä¸€è‡´ã¯å°‘ã—é‡ã¿
  const qs = item.q.toLowerCase();
  for (const t of tokens) if (qs.includes(t)) score += 2;
  return score;
}

// ---- CSVãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ----------------------------------------
function toCSV(rows: string[][]) {
  const esc = (s: string) => '"' + (s ?? "").replaceAll('"', '""') + '"';
  return rows.map(r => r.map(esc).join(",")).join("\n");
}

// ---- éŸ³å£°åˆæˆï¼ˆWeb Speech APIï¼‰ --------------------------------
function speak(text: string, lang = "ja-JP") {
  if (!("speechSynthesis" in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  u.rate = 1.0;
  u.pitch = 1.0;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

// ---- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -------------------------------------
export default function ExpoAIAvatarKiosk() {
  const [companyKey, setCompanyKey] = useState<keyof typeof COMPANY_DATA | null>(null);
  const [input, setInput] = useState("");
  const [muted, setMuted] = useState(false);
  const [messages, setMessages] = useState<{ role: "user" | "assistant"; text: string; company?: string }[]>([
    { role: "assistant", text: "ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚4ç¤¾ã®ä¸­ã‹ã‚‰çŸ¥ã‚ŠãŸã„ä¼šç¤¾ã‚’ãŠé¸ã³ãã ã•ã„ã€‚ã”è³ªå•ãŒã‚ã‚Œã°è©±ã—ã‹ã‘ã¦ãã ã•ã„ã€‚" },
  ]);
  const logRef = useRef<string[][]>([["timestamp","role","company","text"]]);

  const activeCompany = companyKey ? COMPANY_DATA[companyKey] : null;

  // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³
  const enterFullscreen = () => {
    const el = document.documentElement;
    if (el.requestFullscreen) el.requestFullscreen();
  };

  // é€ä¿¡å‡¦ç†
  const handleAsk = (question: string) => {
    const q = question.trim();
    if (!q) return;

    const ts = new Date().toISOString();
    setMessages(m => [...m, { role: "user", text: q, company: activeCompany?.name }]);
    logRef.current.push([ts, "user", activeCompany?.name ?? "-", q]);

    // ä¼šç¤¾æœªé¸æŠæ™‚ã®ã‚¬ãƒ¼ãƒ‰
    if (!activeCompany) {
      const reply = "ã¾ãšã¯ç”»é¢ä¸Šéƒ¨ã®4ç¤¾ã‹ã‚‰ä¼šç¤¾ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚é¸æŠå¾Œã«ã”è³ªå•ã¸å›ç­”ã—ã¾ã™ã€‚";
      setMessages(m => [...m, { role: "assistant", text: reply }]);
      logRef.current.push([new Date().toISOString(), "assistant", "-", reply]);
      if (!muted) speak(reply);
      return;
    }

    // ç°¡æ˜“RAG
    const ranked = activeCompany.faqs
      .map(item => ({ item, score: scoreQA(q, item) }))
      .sort((a, b) => b.score - a.score);

    let answer = "";
    if (ranked[0]?.score > 0) {
      answer = ranked[0].item.a;
    } else {
      answer = `ãã®ã”è³ªå•ã«è¿‘ã„æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\n` +
        `ãƒ»ç”»é¢ä¸‹ã®ã‚¯ã‚¤ãƒƒã‚¯è³ªå•ã‚’ãŠè©¦ã—ãã ã•ã„\n` +
        `ãƒ»è©³ã—ã„ä»•æ§˜ã¯æ‹…å½“ã‚¹ã‚¿ãƒƒãƒ•ãŒã”æ¡ˆå†…ã—ã¾ã™`;
    }

    // ä¼šç¤¾åãƒ»åä¹—ã‚Šã‚’è»½ãä»˜ä¸
    answer = `${activeCompany.logoEmoji} ${activeCompany.name} ã‹ã‚‰ã®ã”æ¡ˆå†…ã§ã™ã€‚\n${answer}`;

    const ats = new Date().toISOString();
    setMessages(m => [...m, { role: "assistant", text: answer, company: activeCompany.name }]);
    logRef.current.push([ats, "assistant", activeCompany.name, answer]);
    if (!muted) speak(answer);
  };

  const handleDownloadCSV = () => {
    const csv = toCSV(logRef.current);
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `kiosk_logs_${new Date().toISOString().replaceAll(":","-")}.csv`;
    a.click();
    URL.revokeObjectURL(url);
  };

  const handleQuick = (text: string) => {
    setInput(text);
    setTimeout(() => handleAsk(text), 50);
  };

  useEffect(() => {
    // ESCã§èª­ã¿ä¸Šã’åœæ­¢
    const onKey = (e: KeyboardEvent) => {
      if (e.key === "Escape") window.speechSynthesis?.cancel();
    };
    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, []);

  return (
    <div className="min-h-screen w-full bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4 md:p-6">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <header className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-4">
        <div>
          <h1 className="text-2xl md:text-3xl font-bold">AIã‚¢ãƒã‚¿ãƒ¼å±•ç¤ºä¼šã‚­ã‚ªã‚¹ã‚¯</h1>
          <p className="text-sm text-slate-300">4ç¤¾ã‹ã‚‰é¸ã‚“ã§è³ªå•ã™ã‚‹ã¨ã€ã‚¢ãƒã‚¿ãƒ¼ãŒéŸ³å£°ã¨å­—å¹•ã§ã”æ¡ˆå†…ã—ã¾ã™ã€‚</p>
        </div>
        <div className="flex items-center gap-2">
          <button onClick={enterFullscreen} className="px-3 py-2 rounded-xl bg-slate-700 hover:bg-slate-600 text-sm">ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</button>
          <button onClick={() => setMuted(m => !m)} className="px-3 py-2 rounded-xl bg-slate-700 hover:bg-slate-600 text-sm">{muted ? "ğŸ”‡ ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤" : "ğŸ”Š ãƒŸãƒ¥ãƒ¼ãƒˆ"}</button>
          <button onClick={handleDownloadCSV} className="px-3 py-2 rounded-xl bg-slate-700 hover:bg-slate-600 text-sm">ãƒ­ã‚°CSV</button>
        </div>
      </header>

      {/* ä¼šç¤¾é¸æŠ */}
      <section className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
        {(Object.keys(COMPANY_DATA) as (keyof typeof COMPANY_DATA)[]).map((k) => {
          const c = COMPANY_DATA[k];
          const active = companyKey === k;
          return (
            <button
              key={k}
              onClick={() => setCompanyKey(k)}
              className={`relative rounded-2xl p-4 text-left transition shadow-lg ${active ? "ring-2 ring-white scale-[1.01]" : "opacity-95 hover:opacity-100"}`}
              style={{}}
            >
              <div className={`absolute inset-0 rounded-2xl bg-gradient-to-br ${c.color} opacity-80`}></div>
              <div className="relative">
                <div className="text-3xl mb-2">{c.logoEmoji}</div>
                <div className="font-semibold">{c.name}</div>
                <div className="text-xs opacity-90 mt-1">ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ</div>
              </div>
            </button>
          );
        })}
      </section>

      {/* æœ¬ä½“ï¼šã‚¢ãƒã‚¿ãƒ¼ + ãƒãƒ£ãƒƒãƒˆ */}
      <main className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {/* å·¦ï¼šã‚¢ãƒã‚¿ãƒ¼ */}
        <div className="md:col-span-1 bg-slate-800/60 rounded-2xl p-4 md:p-6 shadow-xl">
          <div className="flex items-center gap-3 mb-4">
            <div className="text-2xl">{activeCompany?.logoEmoji ?? "ğŸ¤–"}</div>
            <div>
              <div className="font-semibold">{activeCompany?.name ?? "ä¼šç¤¾æœªé¸æŠ"}</div>
              <div className="text-xs text-slate-300">{activeCompany ? "ã”è³ªå•ã«ãŠç­”ãˆã—ã¾ã™" : "ä¸Šã®ãƒœã‚¿ãƒ³ã§ä¼šç¤¾ã‚’ãŠé¸ã³ãã ã•ã„"}</div>
            </div>
          </div>

          {/* ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒã‚¿ãƒ¼ */}
          <div className="relative w-full aspect-[4/3] bg-slate-900 rounded-2xl overflow-hidden grid place-items-center">
            <AvatarFace speaking={messages[messages.length-1]?.role === "assistant"} accent={activeCompany?.color}/>
          </div>

          {/* ã‚¯ã‚¤ãƒƒã‚¯è³ªå• */}
          <div className="mt-4">
            <div className="text-sm text-slate-300 mb-2">ã‚¯ã‚¤ãƒƒã‚¯è³ªå•</div>
            <div className="flex flex-wrap gap-2">
              {(activeCompany?.quick ?? ["ä¸»åŠ›è£½å“ã¯ï¼Ÿ","ä¾¡æ ¼æ„Ÿ","ã‚µãƒãƒ¼ãƒˆ"]).map((q, i) => (
                <button key={i} onClick={() => handleQuick(q)} className="px-3 py-1.5 rounded-full bg-slate-700 hover:bg-slate-600 text-xs">{q}</button>
              ))}
            </div>
          </div>
        </div>

        {/* å³ï¼šãƒãƒ£ãƒƒãƒˆ */}
        <div className="md:col-span-2 bg-slate-800/60 rounded-2xl p-4 md:p-6 shadow-xl flex flex-col">
          <div className="flex-1 overflow-y-auto pr-1 space-y-3">
            {messages.map((m, i) => (
              <div key={i} className={`max-w-[90%] md:max-w-[80%] ${m.role === "user" ? "ml-auto" : ""}`}>
                <div className={`rounded-2xl px-4 py-3 text-sm leading-relaxed shadow ${m.role === "user" ? "bg-sky-600/90" : "bg-slate-700/90"}`}>
                  {m.text.split("\n").map((line, li) => <div key={li}>{line}</div>)}
                </div>
                <div className="text-[10px] text-slate-400 mt-1">{m.role === "user" ? "æ¥å ´è€…" : "ã‚¢ãƒã‚¿ãƒ¼"}{m.company ? `ãƒ»${m.company}` : ""}</div>
              </div>
            ))}
          </div>

          <div className="mt-3 flex gap-2">
            <input
              className="flex-1 bg-slate-900/70 rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-500"
              placeholder={activeCompany ? `${activeCompany.name} ã¸ã®è³ªå•ã‚’å…¥åŠ›â€¦` : "ã¾ãšä¼šç¤¾ã‚’é¸æŠã—ã¦ãã ã•ã„"}
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyDown={(e) => { if (e.key === "Enter") { handleAsk(input); setInput(""); }}}
            />
            <button onClick={() => { handleAsk(input); setInput(""); }} className="px-4 py-2 rounded-xl bg-sky-600 hover:bg-sky-500 text-sm">é€ä¿¡</button>
          </div>

          <div className="mt-2 text-[11px] text-slate-400">
            â€» å®Ÿé‹ç”¨ã§ã¯ç¤¾åˆ¥FAQã‚’JSON/CSVã‹ã‚‰èª­ã¿è¾¼ã¿ã€å¿…è¦ã«å¿œã˜ã¦APIï¼ˆä¾‹ï¼šOpenAIã‚„RAGã‚µãƒ¼ãƒï¼‰ã«åˆ‡æ›¿å¯èƒ½ã§ã™ã€‚
          </div>
        </div>
      </main>

      {/* ãƒ•ãƒƒã‚¿ãƒ¼è£œè¶³ */}
      <footer className="mt-6 text-xs text-slate-400">
        ãƒ»Escã‚­ãƒ¼ã§éŸ³å£°èª­ã¿ä¸Šã’ã‚’åœæ­¢ã§ãã¾ã™ã€‚ãƒ»ãƒãƒƒãƒˆä¸å®‰å®šæ™‚ã¯æœ¬ãƒ­ãƒ¼ã‚«ãƒ«FAQãƒ¢ãƒ¼ãƒ‰ã§é‹ç”¨å¯èƒ½ã€‚ãƒ»ã‚ˆã‚Šé«˜ç²¾åº¦ãŒå¿…è¦ãªã‚‰APIæ¥ç¶šç‰ˆã«å·®ã—æ›¿ãˆã§ãã¾ã™ã€‚
      </footer>
    </div>
  );
}

function AvatarFace({ speaking, accent }: { speaking: boolean; accent?: string }) {
  return (
    <div className="w-[70%] max-w-[380px]">
      <div className={`rounded-3xl p-4 bg-gradient-to-br ${accent ?? "from-slate-700 to-slate-600"} shadow-2xl`}>
        <div className="relative aspect-square rounded-2xl bg-black/30 grid place-items-center">
          {/* é¡” */}
          <div className="w-40 h-40 rounded-full bg-slate-200 relative">
            {/* ç›® */}
            <div className="absolute top-1/3 left-1/4 w-5 h-5 bg-slate-900 rounded-full"/>
            <div className="absolute top-1/3 right-1/4 w-5 h-5 bg-slate-900 rounded-full"/>
            {/* å£ */}
            <div className={`absolute bottom-8 left-1/2 -translate-x-1/2 w-16 h-3 bg-slate-900 rounded-full transition-all ${speaking ? "animate-pulse" : ""}`}/>
          </div>
        </div>
        <div className="mt-3 text-center text-sm opacity-90">AIã‚¢ãƒã‚¿ãƒ¼</div>
      </div>
    </div>
  );
}
